<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>chatterbox</title>
    <link rel="stylesheet" href="styles/styles.css">

    <!-- dependencies -->
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script>
      // YOU DO NOT NEED TO EDIT THIS CODE
      // if (!/(&|\?)username=/.test(window.location.search)) {
      //   var newSearch = window.location.search;
      //   if (newSearch !== '' & newSearch !== '?') {
      //     newSearch += '&';
      //   }
      //   newSearch += 'username=' + (prompt('What is your name?') || 'anonymous');
      //   window.location.search = newSearch;
      // }
    var userName = prompt('What is your name?');
    </script>
    <!-- your scripts -->
    <script src="env/config.js"></script>
    <script src="scripts/app.js"></script>
  </head>
  <body>
    <div id="main">
      <h1>chatterbox</h1>

      <select id="roomSelect">
        <option class="room" value="All">All</option>
      </select>

      <button type="button" id="add-room">+</button>

      <p>Type your messages here:</p>
      <input id="input" type="text"> </input>
      <button type="button" class="submit" id="send"> Submit </button> 

      <!-- Your HTML goes here! -->
    </div>
    <div id="chats" class="chats">  
      <!-- messsages go here -->
    </div>

  <script>
    $(document).ready(function (){

      app.fetch();
  
      var fetchBasedOnRoom = function() {
        if (app.currentRoom === 'All') {
          app.fetch();
        } else {
          app.fetchByRoom(app.currentRoom)
        }
      }

      var renderData = function() {
        var chatterArray = app.messagesArray.results;
        for (var j = chatterArray.length-1; j >= 0; j--) {
          var tempObj = {};
          tempObj.username = chatterArray[j].username;
          tempObj.text = chatterArray[j].text;
          tempObj.roomname = chatterArray[j].roomname;
          app.renderMessage(tempObj);
        }



        // if (app.currentRoom === 'All') {
        //   var chatterArray = app.messagesArray.results;
        //   for (var j = chatterArray.length-1; j >= 0; j--) {
        //     var tempObj = {};
        //     tempObj.username = chatterArray[j].username;
        //     tempObj.text = chatterArray[j].text;
        //     tempObj.roomname = chatterArray[j].roomname;
        //     app.renderMessage(tempObj);
        //   }
        // } else {
        //   var roomArray = app.rooms[app.currentRoom];
        //   for (var j = roomArray.length-1; j >= 0; j--) {
        //     if( roomArray[j].roomname === app.currentRoom){
        //       var tempObj = {};
        //       tempObj.username = roomArray[j].username;
        //       tempObj.text = roomArray[j].text;
        //       tempObj.roomname = roomArray[j].roomname;
        //       app.renderMessage(tempObj);
        //     }
        //   }
        // }
        
      };

      // var gatherRoomData = function () {
      //   var chatterArray = app.messagesArray.results;
      //   var roomsMessagesObj = {};      

      //   for (var i = 0; i < chatterArray.length; i++) {
      //     var room = chatterArray[i].roomname;
      //     if (app.rooms[room]) {
      //       roomsMessagesObj[room][]
      //         chatterArray[i].objectId = chatterArray[i]
      //       }
      //     }
      //   }

      //   for (var keys in roomsMessagesObj) {
      //     for (var innerKeys in room)
      //   }
      // }


      setTimeout(function(){ 
        renderData()
      } , 500);

      setInterval(function(){
        fetchBasedOnRoom();
        //fetch new data
        //below clears window and loads fetched data;
        setTimeout(function(){
          app.clearMessages();
          renderData()
        } , 1000);

      } , 4000);

      // adding listener to the room drop down list
      $("#roomSelect").change(function() {
        // Pure JS
        app.currentRoom = this.value;
      });

      $('#add-room').click(function(){
        var newRoom = prompt('Enter room name.');
        app.renderRoom(newRoom);
        app.rooms[newRoom] = {};
        
      });

      $('#send').click(function() {
        var textInput = $('#input').val();
        var message = {
          username: userName,
          text: textInput,
          roomname: $('#roomSelect').val()
        };
        
        if (message.text.length === 0) {
          alert('Write something!');
        } else {
          app.renderMessage(message);
          app.send(message);
          $('#input').val('');
        }

      });

      // $('#delete').click(function() {
        
      //   app.clearMessages();
      //   app.fetch();
      // });

      //trying to toggle friends
      // $('.username').on('click', function(){
      //   $(this).toggleClass('friend-class');
      // });

    }); 
  </script>
  </body>
</html>
